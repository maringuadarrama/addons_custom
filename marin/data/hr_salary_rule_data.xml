<?xml version="1.0" encoding="UTF-8" ?>
<odoo noupdate="1">
    <!-- Estructure FF -->
    <!-- Perceptions -->
    <record id="hr_salary_rule_perception_001_g_601_ff" model="hr.salary.rule">
        <field name="name">Sueldos, Salarios Rayas y Jornales</field>
        <field name="code">PG001</field>
        <field name="l10n_mx_edi_code">001</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_ff" />
        <field name="sequence">10</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_taxed" />
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
daily_wage = contract.wage/30

if contract.l10n_mx_edi_schedule_pay_id.code ==  '01':
    result = daily_wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '02':
    result = daily_wage * 7
elif contract.l10n_mx_edi_schedule_pay_id.code == '03':
    result = daily_wage * 14
elif contract.l10n_mx_edi_schedule_pay_id.code == '04':
    result = contract.wage * 0.5
elif contract.l10n_mx_edi_schedule_pay_id.code == '05':
    result = contract.wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '06':
    result = contract.wage * 2
elif contract.l10n_mx_edi_schedule_pay_id.code == '10':
    result = contract.wage * 10
        </field>
    </record>

    <!-- Deductions -->
    <record id="hr_salary_rule_deduction_001_601_ff" model="hr.salary.rule">
        <field name="name">Seguridad social</field>
        <field name="code">001</field>
        <field name="l10n_mx_edi_code">001</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_ff" />
        <field name="sequence">31</field>
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
minimum_wage = contract.company_id.l10n_mx_edi_minimum_wage
result = 0
if contract.wage/30 == minimum_wage:
    result = 0
else:
    sbc = contract._get_integrated_salary(date_to=payslip.date_to)[0]
    days_schedule = {'01': 1, '02': 7, '03': 14, '04': 15, '05': 30, '06': 60}
    days_work = days_schedule.get(contract.l10n_mx_edi_schedule_pay_id.days_to_pay, 0)
    salary = days_work * sbc
    result = 0.02375 * salary
    imss = 0
    if ((sbc / minimum_wage) > 3):
        imss = 0.004 * (sbc - minimum_wage * 3) * days_work
    result = (result + imss) * -1
        </field>
    </record>

    <record id="hr_salary_rule_deduction_isr_601_ff" model="hr.salary.rule">
        <field name="name">AUXILIAR ISR</field>
        <field name="code">AUX_ISR</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_ff" />
        <field name="sequence">71</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_aux_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
minimum_wage = contract.company_id.l10n_mx_edi_minimum_wage
if contract.wage/30 == minimum_wage:
    pass
else:
    income_period = categories['PERGRA']
    # Table ISR (limite_inferior, limite_superior, cuota_fija, tasa)
    table = {'05': [(0.01, 746.04, 0.00, 0.0192), (746.05, 6332.05, 14.32, 0.0640),
            (6332.06, 11128.01, 371.83, 0.1088), (11128.02, 12935.82, 893.63, 0.1600),
            (12935.83, 15487.71, 1182.88, 0.1792), (15487.72, 31236.49, 1640.18, 0.2136),
            (31236.50, 49233.00, 5004.12, 0.2352), (49233.01, 93993.90, 9236.89, 0.3000),
            (93993.91, 125325.20, 22665.17, 0.3200), (125325.21, 375975.61, 32691.18, 0.3400),
            (375975.62, 999999999, 117912.32, 0.3500)],
            '04': [(0.01, 368.10, 0.00, 0.0192), (368.11, 3124.35, 7.05, 0.0640),
            (3124.36, 5490.75, 183.45,  0.1088), (5490.76, 6382.80, 441.00,  0.1600),
            (6382.81, 7641.90, 583.65,  0.1792), (7641.91, 15412.80, 809.25, 0.2136),
            (15412.81, 24292.65, 2469.15, 0.2352), (24292.66, 46378.50, 4557.75, 0.3000),
            (46378.51, 61838.10, 11183.40, 0.3200), (61838.11, 185514.30, 16130.55, 0.3400),
            (185514.31, 999999999, 58180.35, 0.3500)],
            '02': [(0.01, 171.78, 0.00, 0.0192), (171.79, 1458.03, 3.29, 0.0640),
            (1458.04, 2562.35, 85.61, 0.1088), (2562.36, 2978.64, 205.80, 0.1600),
            (2978.65, 3566.22, 272.37, 0.1792), (3566.23, 7192.64, 377.65, 0.2136),
            (7192.65, 11336.57, 1152.27, 0.2352), (11336.58, 21643.30, 2126.95, 0.3000),
            (21643.31, 28857.78, 5218.92, 0.3200), (28857.79, 86573.34, 7527.59, 0.3400),
            (86573.35, 99999999, 27150.83, 0.3500)],
            '01': [(0.01, 24.54, 0.00, 0.0192), (24.55, 208.29, 0.47, 0.0640),
            (208.30, 366.05, 12.23, 0.1088), (366.06, 425.52, 29.40, 0.1600),
            (425.53, 509.46, 38.91, 0.1792), (509.47, 1027.52, 53.95, 0.2136),
            (1027.53, 1619.51, 164.61, 0.2352), (1619.52, 3091.90, 303.85, 0.3000),
            (3091.91, 4122.54, 745.56, 0.3200), (4122.55, 12367.62, 1075.37, 0.3400),
            (12367.63, 99999999, 3878.69, 0.3500)],
            '10': [(0.01, 245.40, 0.00, 0.0192), (245.41, 2082.90, 4.70, 0.0640),
            (2082.91, 3660.50, 122.30, 0.1088), (3660.51, 4255.20, 294.00, 0.1600),
            (4255.21, 5094.60, 389.10, 0.1792), (5094.61, 10275.20, 539.50, 0.2136),
            (10275.21, 16195.10, 1646.10, 0.2352), (16195.11, 30919.00, 3038.50, 0.3000),
            (30,919.01, 41225.40, 7455.60, 0.3200), (41225.41, 123676.20, 10753.70, 0.3400),
            (123676.21, 99999999, 38786.90, 0.3500)]}
    table_isr = table.get(contract.l10n_mx_edi_schedule_pay_id.code, [])
    if table_isr:
        for value in table_isr:
            if income_period >=value[0] and value[1] >= income_period:
                extra = income_period - value[0]
                result = ((extra * value[3]) + value[2]) * -1
                break
        </field>
    </record>

    <record id="hr_salary_rule_deduction_002_601_ff" model="hr.salary.rule">
        <field name="name">ISR</field>
        <field name="code">ISR002</field>
        <field name="l10n_mx_edi_code">002</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_ff" />
        <field name="sequence">73</field>
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = (abs(AUX_ISR) - AUX_OP002) * -1 if abs(AUX_ISR) - AUX_OP002 &gt; 0 else 0</field>
    </record>

    <record id="hr_salary_rule_deduction_004_601_ff" model="hr.salary.rule">
        <field name="name">Otros</field>
        <field name="code">004</field>
        <field name="l10n_mx_edi_code">004</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_ff" />
        <field name="sequence">61</field>
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['d_004'].amount * -1 if 'd_004' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_deduction_004_601_ff" model="hr.payslip.input.type">
        <field name="name">Otros - deduccion</field>
        <field name="code">d_004</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_601_ff')])]" />
    </record>

    <!-- Other -->
    <record id="hr_salary_rule_other_payment_aux_002_601_ff" model="hr.salary.rule">
        <field name="name">Auxiliar Subsidio para el empleo</field>
        <field name="code">AUX_OP002</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_ff" />
        <field name="sequence">70</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_aux_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
# Based on http://www.sat.gob.mx/informacion_fiscal/devoluciones_compensaciones/Paginas/subsidio_al_empleo.aspx
result = 0.00
if not employee.l10n_mx_edi_is_assimilated:
    minimum_wage = contract.company_id.l10n_mx_edi_minimum_wage
    if contract.wage/30 == minimum_wage:
        pass
    else:
        income_period = categories['PERGRA']
        table = {
            '10': [
                (0.01, 581.90, 133.90),
                (581.91, 872.80, 133.80),
                (872.81, 1142.40, 133.80),
                (1142.41, 1163.80, 129.20),
                (1163.81, 1462.50, 125.80),
                (1462.51, 1551.70, 116.50),
                (1551.71, 1755.10, 106.90),
                (1755.11, 2047.60, 96.90),
                (2047.61, 2340.10, 83.40),
                (2340.11, 2428.40, 71.60),
                (2428.41, 99999999.00, 0)],
            '05': [
                (0.01, 1768.96, 407.02),
                (1768.97, 2653.38, 406.83),
                (2653.39, 3472.84, 406.62),
                (3472.85, 3537.87, 392.77),
                (3537.88, 4446.15, 382.46),
                (4446.16, 4717.18, 354.23),
                (4717.19, 5335.42, 324.87),
                (5335.43, 6224.67, 294.63),
                (6224.68, 7113.90, 253.54),
                (7113.91, 7382.33, 217.61),
                (7382.34, 99999999.00, 0)],
            '04': [
                (0.01, 872.85, 200.85),
                (872.86, 1309.20, 200.70),
                (1309.21, 1713.60, 200.70),
                (1713.61, 1745.70, 193.80),
                (1745.71, 2193.75, 188.70),
                (2193.76, 2327.55, 174.75),
                (2327.56, 2632.65, 160.35),
                (2632.66, 3071.40, 145.35),
                (3071.41, 3510.15, 125.10),
                (3510.16, 3642.60, 107.40),
                (3642.61, 99999999.00, 0)],
            '02': [
                (0.01, 407.33, 93.73),
                (407.34, 610.96, 93.66),
                (610.97, 799.68, 93.66),
                (799.69, 814.66, 90.44),
                (814.67, 1023.75, 88.06),
                (1023.76, 1086.19, 81.55),
                (1086.20, 1228.57, 74.83),
                (1228.58, 1433.32, 67.83),
                (1433.33, 1638.07, 58.38),
                (1638.08, 1699.88, 50.12),
                (1699.89, 99999999.00, 0)],
            '01': [
                (0.01, 58.19, 13.39),
                (58.20, 87.28, 13.38),
                (87.29, 114.24, 13.38),
                (114.25, 116.38, 12.92),
                (116.39, 146.25, 12.58),
                (146.26, 155.17, 11.65),
                (155.18, 175.51, 10.69),
                (175.52, 204.76, 9.69),
                (204.77, 234.01, 8.34),
                (234.02, 242.84, 7.16),
                (242.85, 99999999.00, 0)],
        }
        table_aux = table.get(contract.l10n_mx_edi_schedule_pay_id.code, [])
        if table_aux:
            for value in table_aux:
                if income_period >= value[0] and value[1] >= income_period:
                    result = value[2]
                    break
        </field>
    </record>

    <record id="hr_salary_rule_other_payment_002_601_ff" model="hr.salary.rule">
        <field name="name">Subsidio para el empleo - efectivamente entregado al trabajador</field>
        <field name="code">OP002</field>
        <field name="l10n_mx_edi_code">002</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_ff" />
        <field name="sequence">72</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_other_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = AUX_OP002
result = result - abs(AUX_ISR) if result &gt; abs(AUX_ISR) else 0
        </field>
    </record>

    <record id="hr_salary_rule_other_payment_999_601_ff" model="hr.salary.rule">
        <field
            name="name"
        >Pagos distintos a los listados y que no deben considerarse como ingreso por sueldos, salarios o ingresos asimilados</field>
        <field name="code">OP999</field>
        <field name="l10n_mx_edi_code">999</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_ff" />
        <field name="sequence">21</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_other_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['op_999'].amount if 'op_999 ' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_other_payment_999_601_ff" model="hr.payslip.input.type">
        <field
            name="name"
        >Pagos distintos a los listados y que no deben considerarse como ingreso por sueldos, salarios o ingresos asimilados</field>
        <field name="code">op_999</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_601_ff')])]" />
    </record>

    <!-- Neto -->
    <record id="hr_rule_net_salary_601_ff" model="hr.salary.rule">
        <field name="name">Salario Neto</field>
        <field name="code">NET</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_ff" />
        <field name="sequence">81</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_netsa_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = categories['PERGRA'] + categories['DED'] + categories['PEREXE'] + categories['OTHER']</field>
    </record>

    <!-- Perceptions -->
    <record id="hr_salary_rule_perception_001_g_602_ff" model="hr.salary.rule">
        <field name="name">Sueldos, Salarios Rayas y Jornales</field>
        <field name="code">PG001</field>
        <field name="l10n_mx_edi_code">001</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_ff" />
        <field name="sequence">10</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_taxed" />
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
daily_wage = contract.wage/30

if contract.l10n_mx_edi_schedule_pay_id.code ==  '01':
    result = daily_wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '02':
    result = daily_wage * 7
elif contract.l10n_mx_edi_schedule_pay_id.code == '03':
    result = daily_wage * 14
elif contract.l10n_mx_edi_schedule_pay_id.code == '04':
    result = contract.wage * 0.5
elif contract.l10n_mx_edi_schedule_pay_id.code == '05':
    result = contract.wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '06':
    result = contract.wage * 2
elif contract.l10n_mx_edi_schedule_pay_id.code == '10':
    result = contract.wage * 10
        </field>
    </record>

    <!-- Deductions -->
    <record id="hr_salary_rule_deduction_001_602_ff" model="hr.salary.rule">
        <field name="name">Seguridad social</field>
        <field name="code">001</field>
        <field name="l10n_mx_edi_code">001</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_ff" />
        <field name="sequence">31</field>
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
minimum_wage = contract.company_id.l10n_mx_edi_minimum_wage
result = 0
if contract.wage/30 == minimum_wage:
    result = 0
else:
    sbc = contract._get_integrated_salary(date_to=payslip.date_to)[0]
    days_schedule = {'01': 1, '02': 7, '03': 14, '04': 15, '05': 30, '06': 60}
    days_work = days_schedule.get(contract.l10n_mx_edi_schedule_pay_id.days_to_pay, 0)
    salary = days_work * sbc
    result = 0.02375 * salary
    imss = 0
    if ((sbc / minimum_wage) > 3):
        imss = 0.004 * (sbc - minimum_wage * 3) * days_work
    result = (result + imss) * -1
        </field>
    </record>

    <record id="hr_salary_rule_deduction_isr_602_ff" model="hr.salary.rule">
        <field name="name">AUXILIAR ISR</field>
        <field name="code">AUX_ISR</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_ff" />
        <field name="sequence">71</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_aux_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
minimum_wage = contract.company_id.l10n_mx_edi_minimum_wage
if contract.wage/30 == minimum_wage:
    pass
else:
    income_period = categories['PERGRA']
    # Table ISR (limite_inferior, limite_superior, cuota_fija, tasa)
    table = {'05': [(0.01, 746.04, 0.00, 0.0192), (746.05, 6332.05, 14.32, 0.0640),
            (6332.06, 11128.01, 371.83, 0.1088), (11128.02, 12935.82, 893.63, 0.1600),
            (12935.83, 15487.71, 1182.88, 0.1792), (15487.72, 31236.49, 1640.18, 0.2136),
            (31236.50, 49233.00, 5004.12, 0.2352), (49233.01, 93993.90, 9236.89, 0.3000),
            (93993.91, 125325.20, 22665.17, 0.3200), (125325.21, 375975.61, 32691.18, 0.3400),
            (375975.62, 999999999, 117912.32, 0.3500)],
            '04': [(0.01, 368.10, 0.00, 0.0192), (368.11, 3124.35, 7.05, 0.0640),
            (3124.36, 5490.75, 183.45,  0.1088), (5490.76, 6382.80, 441.00,  0.1600),
            (6382.81, 7641.90, 583.65,  0.1792), (7641.91, 15412.80, 809.25, 0.2136),
            (15412.81, 24292.65, 2469.15, 0.2352), (24292.66, 46378.50, 4557.75, 0.3000),
            (46378.51, 61838.10, 11183.40, 0.3200), (61838.11, 185514.30, 16130.55, 0.3400),
            (185514.31, 999999999, 58180.35, 0.3500)],
            '02': [(0.01, 171.78, 0.00, 0.0192), (171.79, 1458.03, 3.29, 0.0640),
            (1458.04, 2562.35, 85.61, 0.1088), (2562.36, 2978.64, 205.80, 0.1600),
            (2978.65, 3566.22, 272.37, 0.1792), (3566.23, 7192.64, 377.65, 0.2136),
            (7192.65, 11336.57, 1152.27, 0.2352), (11336.58, 21643.30, 2126.95, 0.3000),
            (21643.31, 28857.78, 5218.92, 0.3200), (28857.79, 86573.34, 7527.59, 0.3400),
            (86573.35, 99999999, 27150.83, 0.3500)],
            '01': [(0.01, 24.54, 0.00, 0.0192), (24.55, 208.29, 0.47, 0.0640),
            (208.30, 366.05, 12.23, 0.1088), (366.06, 425.52, 29.40, 0.1600),
            (425.53, 509.46, 38.91, 0.1792), (509.47, 1027.52, 53.95, 0.2136),
            (1027.53, 1619.51, 164.61, 0.2352), (1619.52, 3091.90, 303.85, 0.3000),
            (3091.91, 4122.54, 745.56, 0.3200), (4122.55, 12367.62, 1075.37, 0.3400),
            (12367.63, 99999999, 3878.69, 0.3500)],
            '10': [(0.01, 245.40, 0.00, 0.0192), (245.41, 2082.90, 4.70, 0.0640),
            (2082.91, 3660.50, 122.30, 0.1088), (3660.51, 4255.20, 294.00, 0.1600),
            (4255.21, 5094.60, 389.10, 0.1792), (5094.61, 10275.20, 539.50, 0.2136),
            (10275.21, 16195.10, 1646.10, 0.2352), (16195.11, 30919.00, 3038.50, 0.3000),
            (30,919.01, 41225.40, 7455.60, 0.3200), (41225.41, 123676.20, 10753.70, 0.3400),
            (123676.21, 99999999, 38786.90, 0.3500)]}
    table_isr = table.get(contract.l10n_mx_edi_schedule_pay_id.code, [])
    if table_isr:
        for value in table_isr:
            if income_period >=value[0] and value[1] >= income_period:
                extra = income_period - value[0]
                result = ((extra * value[3]) + value[2]) * -1
                break
        </field>
    </record>

    <record id="hr_salary_rule_deduction_002_602_ff" model="hr.salary.rule">
        <field name="name">ISR</field>
        <field name="code">ISR002</field>
        <field name="l10n_mx_edi_code">002</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_ff" />
        <field name="sequence">73</field>
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = (abs(AUX_ISR) - AUX_OP002) * -1 if abs(AUX_ISR) - AUX_OP002 &gt; 0 else 0</field>
    </record>

    <record id="hr_salary_rule_deduction_004_602_ff" model="hr.salary.rule">
        <field name="name">Otros</field>
        <field name="code">004</field>
        <field name="l10n_mx_edi_code">004</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_ff" />
        <field name="sequence">61</field>
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['d_004'].amount * -1 if 'd_004' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_deduction_004_602_ff" model="hr.payslip.input.type">
        <field name="name">Otros - deduccion</field>
        <field name="code">d_004</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_602_ff')])]" />
    </record>

    <!-- Other -->
    <record id="hr_salary_rule_other_payment_aux_002_602_ff" model="hr.salary.rule">
        <field name="name">Auxiliar Subsidio para el empleo</field>
        <field name="code">AUX_OP002</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_ff" />
        <field name="sequence">70</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_aux_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
# Based on http://www.sat.gob.mx/informacion_fiscal/devoluciones_compensaciones/Paginas/subsidio_al_empleo.aspx
result = 0.00
if not employee.l10n_mx_edi_is_assimilated:
    minimum_wage = contract.company_id.l10n_mx_edi_minimum_wage
    if contract.wage/30 == minimum_wage:
        pass
    else:
        income_period = categories['PERGRA']
        table = {
            '10': [
                (0.01, 581.90, 133.90),
                (581.91, 872.80, 133.80),
                (872.81, 1142.40, 133.80),
                (1142.41, 1163.80, 129.20),
                (1163.81, 1462.50, 125.80),
                (1462.51, 1551.70, 116.50),
                (1551.71, 1755.10, 106.90),
                (1755.11, 2047.60, 96.90),
                (2047.61, 2340.10, 83.40),
                (2340.11, 2428.40, 71.60),
                (2428.41, 99999999.00, 0)],
            '05': [
                (0.01, 1768.96, 407.02),
                (1768.97, 2653.38, 406.83),
                (2653.39, 3472.84, 406.62),
                (3472.85, 3537.87, 392.77),
                (3537.88, 4446.15, 382.46),
                (4446.16, 4717.18, 354.23),
                (4717.19, 5335.42, 324.87),
                (5335.43, 6224.67, 294.63),
                (6224.68, 7113.90, 253.54),
                (7113.91, 7382.33, 217.61),
                (7382.34, 99999999.00, 0)],
            '04': [
                (0.01, 872.85, 200.85),
                (872.86, 1309.20, 200.70),
                (1309.21, 1713.60, 200.70),
                (1713.61, 1745.70, 193.80),
                (1745.71, 2193.75, 188.70),
                (2193.76, 2327.55, 174.75),
                (2327.56, 2632.65, 160.35),
                (2632.66, 3071.40, 145.35),
                (3071.41, 3510.15, 125.10),
                (3510.16, 3642.60, 107.40),
                (3642.61, 99999999.00, 0)],
            '02': [
                (0.01, 407.33, 93.73),
                (407.34, 610.96, 93.66),
                (610.97, 799.68, 93.66),
                (799.69, 814.66, 90.44),
                (814.67, 1023.75, 88.06),
                (1023.76, 1086.19, 81.55),
                (1086.20, 1228.57, 74.83),
                (1228.58, 1433.32, 67.83),
                (1433.33, 1638.07, 58.38),
                (1638.08, 1699.88, 50.12),
                (1699.89, 99999999.00, 0)],
            '01': [
                (0.01, 58.19, 13.39),
                (58.20, 87.28, 13.38),
                (87.29, 114.24, 13.38),
                (114.25, 116.38, 12.92),
                (116.39, 146.25, 12.58),
                (146.26, 155.17, 11.65),
                (155.18, 175.51, 10.69),
                (175.52, 204.76, 9.69),
                (204.77, 234.01, 8.34),
                (234.02, 242.84, 7.16),
                (242.85, 99999999.00, 0)],
        }
        table_aux = table.get(contract.l10n_mx_edi_schedule_pay_id.code, [])
        if table_aux:
            for value in table_aux:
                if income_period >= value[0] and value[1] >= income_period:
                    result = value[2]
                    break
        </field>
    </record>

    <record id="hr_salary_rule_other_payment_002_602_ff" model="hr.salary.rule">
        <field name="name">Subsidio para el empleo - efectivamente entregado al trabajador</field>
        <field name="code">OP002</field>
        <field name="l10n_mx_edi_code">002</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_ff" />
        <field name="sequence">72</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_other_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = AUX_OP002
result = result - abs(AUX_ISR) if result &gt; abs(AUX_ISR) else 0
        </field>
    </record>

    <record id="hr_salary_rule_other_payment_999_602_ff" model="hr.salary.rule">
        <field
            name="name"
        >Pagos distintos a los listados y que no deben considerarse como ingreso por sueldos, salarios o ingresos asimilados</field>
        <field name="code">OP999</field>
        <field name="l10n_mx_edi_code">999</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_ff" />
        <field name="sequence">21</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_other_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['op_999'].amount if 'op_999 ' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_other_payment_999_602_ff" model="hr.payslip.input.type">
        <field
            name="name"
        >Pagos distintos a los listados y que no deben considerarse como ingreso por sueldos, salarios o ingresos asimilados</field>
        <field name="code">op_999</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_602_ff')])]" />
    </record>

    <!-- Neto -->
    <record id="hr_rule_net_salary_602_ff" model="hr.salary.rule">
        <field name="name">Salario Neto</field>
        <field name="code">NET</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_ff" />
        <field name="sequence">81</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_netsa_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = categories['PERGRA'] + categories['DED'] + categories['PEREXE'] + categories['OTHER']</field>
    </record>

    <!-- Perceptions -->
    <record id="hr_salary_rule_perception_001_g_603_ff" model="hr.salary.rule">
        <field name="name">Sueldos, Salarios Rayas y Jornales</field>
        <field name="code">PG001</field>
        <field name="l10n_mx_edi_code">001</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_ff" />
        <field name="sequence">10</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_taxed" />
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
daily_wage = contract.wage/30

if contract.l10n_mx_edi_schedule_pay_id.code ==  '01':
    result = daily_wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '02':
    result = daily_wage * 7
elif contract.l10n_mx_edi_schedule_pay_id.code == '03':
    result = daily_wage * 14
elif contract.l10n_mx_edi_schedule_pay_id.code == '04':
    result = contract.wage * 0.5
elif contract.l10n_mx_edi_schedule_pay_id.code == '05':
    result = contract.wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '06':
    result = contract.wage * 2
elif contract.l10n_mx_edi_schedule_pay_id.code == '10':
    result = contract.wage * 10
        </field>
    </record>

    <!-- Deductions -->
    <record id="hr_salary_rule_deduction_001_603_ff" model="hr.salary.rule">
        <field name="name">Seguridad social</field>
        <field name="code">001</field>
        <field name="l10n_mx_edi_code">001</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_ff" />
        <field name="sequence">31</field>
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
minimum_wage = contract.company_id.l10n_mx_edi_minimum_wage
result = 0
if contract.wage/30 == minimum_wage:
    result = 0
else:
    sbc = contract._get_integrated_salary(date_to=payslip.date_to)[0]
    days_schedule = {'01': 1, '02': 7, '03': 14, '04': 15, '05': 30, '06': 60}
    days_work = days_schedule.get(contract.l10n_mx_edi_schedule_pay_id.days_to_pay, 0)
    salary = days_work * sbc
    result = 0.02375 * salary
    imss = 0
    if ((sbc / minimum_wage) > 3):
        imss = 0.004 * (sbc - minimum_wage * 3) * days_work
    result = (result + imss) * -1
        </field>
    </record>

    <record id="hr_salary_rule_deduction_isr_603_ff" model="hr.salary.rule">
        <field name="name">AUXILIAR ISR</field>
        <field name="code">AUX_ISR</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_ff" />
        <field name="sequence">71</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_aux_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
minimum_wage = contract.company_id.l10n_mx_edi_minimum_wage
if contract.wage/30 == minimum_wage:
    pass
else:
    income_period = categories['PERGRA']
    # Table ISR (limite_inferior, limite_superior, cuota_fija, tasa)
    table = {'05': [(0.01, 746.04, 0.00, 0.0192), (746.05, 6332.05, 14.32, 0.0640),
            (6332.06, 11128.01, 371.83, 0.1088), (11128.02, 12935.82, 893.63, 0.1600),
            (12935.83, 15487.71, 1182.88, 0.1792), (15487.72, 31236.49, 1640.18, 0.2136),
            (31236.50, 49233.00, 5004.12, 0.2352), (49233.01, 93993.90, 9236.89, 0.3000),
            (93993.91, 125325.20, 22665.17, 0.3200), (125325.21, 375975.61, 32691.18, 0.3400),
            (375975.62, 999999999, 117912.32, 0.3500)],
            '04': [(0.01, 368.10, 0.00, 0.0192), (368.11, 3124.35, 7.05, 0.0640),
            (3124.36, 5490.75, 183.45,  0.1088), (5490.76, 6382.80, 441.00,  0.1600),
            (6382.81, 7641.90, 583.65,  0.1792), (7641.91, 15412.80, 809.25, 0.2136),
            (15412.81, 24292.65, 2469.15, 0.2352), (24292.66, 46378.50, 4557.75, 0.3000),
            (46378.51, 61838.10, 11183.40, 0.3200), (61838.11, 185514.30, 16130.55, 0.3400),
            (185514.31, 999999999, 58180.35, 0.3500)],
            '02': [(0.01, 171.78, 0.00, 0.0192), (171.79, 1458.03, 3.29, 0.0640),
            (1458.04, 2562.35, 85.61, 0.1088), (2562.36, 2978.64, 205.80, 0.1600),
            (2978.65, 3566.22, 272.37, 0.1792), (3566.23, 7192.64, 377.65, 0.2136),
            (7192.65, 11336.57, 1152.27, 0.2352), (11336.58, 21643.30, 2126.95, 0.3000),
            (21643.31, 28857.78, 5218.92, 0.3200), (28857.79, 86573.34, 7527.59, 0.3400),
            (86573.35, 99999999, 27150.83, 0.3500)],
            '01': [(0.01, 24.54, 0.00, 0.0192), (24.55, 208.29, 0.47, 0.0640),
            (208.30, 366.05, 12.23, 0.1088), (366.06, 425.52, 29.40, 0.1600),
            (425.53, 509.46, 38.91, 0.1792), (509.47, 1027.52, 53.95, 0.2136),
            (1027.53, 1619.51, 164.61, 0.2352), (1619.52, 3091.90, 303.85, 0.3000),
            (3091.91, 4122.54, 745.56, 0.3200), (4122.55, 12367.62, 1075.37, 0.3400),
            (12367.63, 99999999, 3878.69, 0.3500)],
            '10': [(0.01, 245.40, 0.00, 0.0192), (245.41, 2082.90, 4.70, 0.0640),
            (2082.91, 3660.50, 122.30, 0.1088), (3660.51, 4255.20, 294.00, 0.1600),
            (4255.21, 5094.60, 389.10, 0.1792), (5094.61, 10275.20, 539.50, 0.2136),
            (10275.21, 16195.10, 1646.10, 0.2352), (16195.11, 30919.00, 3038.50, 0.3000),
            (30,919.01, 41225.40, 7455.60, 0.3200), (41225.41, 123676.20, 10753.70, 0.3400),
            (123676.21, 99999999, 38786.90, 0.3500)]}
    table_isr = table.get(contract.l10n_mx_edi_schedule_pay_id.code, [])
    if table_isr:
        for value in table_isr:
            if income_period >=value[0] and value[1] >= income_period:
                extra = income_period - value[0]
                result = ((extra * value[3]) + value[2]) * -1
                break
        </field>
    </record>

    <record id="hr_salary_rule_deduction_002_603_ff" model="hr.salary.rule">
        <field name="name">ISR</field>
        <field name="code">ISR002</field>
        <field name="l10n_mx_edi_code">002</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_ff" />
        <field name="sequence">73</field>
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = (abs(AUX_ISR) - AUX_OP002) * -1 if abs(AUX_ISR) - AUX_OP002 &gt; 0 else 0</field>
    </record>

    <record id="hr_salary_rule_deduction_004_603_ff" model="hr.salary.rule">
        <field name="name">Otros</field>
        <field name="code">004</field>
        <field name="l10n_mx_edi_code">004</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_ff" />
        <field name="sequence">61</field>
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['d_004'].amount * -1 if 'd_004' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_deduction_004_603_ff" model="hr.payslip.input.type">
        <field name="name">Otros - deduccion</field>
        <field name="code">d_004</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_603_ff')])]" />
    </record>

    <!-- Other -->
    <record id="hr_salary_rule_other_payment_aux_002_603_ff" model="hr.salary.rule">
        <field name="name">Auxiliar Subsidio para el empleo</field>
        <field name="code">AUX_OP002</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_ff" />
        <field name="sequence">70</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_aux_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
# Based on http://www.sat.gob.mx/informacion_fiscal/devoluciones_compensaciones/Paginas/subsidio_al_empleo.aspx
result = 0.00
if not employee.l10n_mx_edi_is_assimilated:
    minimum_wage = contract.company_id.l10n_mx_edi_minimum_wage
    if contract.wage/30 == minimum_wage:
        pass
    else:
        income_period = categories['PERGRA']
        table = {
            '10': [
                (0.01, 581.90, 133.90),
                (581.91, 872.80, 133.80),
                (872.81, 1142.40, 133.80),
                (1142.41, 1163.80, 129.20),
                (1163.81, 1462.50, 125.80),
                (1462.51, 1551.70, 116.50),
                (1551.71, 1755.10, 106.90),
                (1755.11, 2047.60, 96.90),
                (2047.61, 2340.10, 83.40),
                (2340.11, 2428.40, 71.60),
                (2428.41, 99999999.00, 0)],
            '05': [
                (0.01, 1768.96, 407.02),
                (1768.97, 2653.38, 406.83),
                (2653.39, 3472.84, 406.62),
                (3472.85, 3537.87, 392.77),
                (3537.88, 4446.15, 382.46),
                (4446.16, 4717.18, 354.23),
                (4717.19, 5335.42, 324.87),
                (5335.43, 6224.67, 294.63),
                (6224.68, 7113.90, 253.54),
                (7113.91, 7382.33, 217.61),
                (7382.34, 99999999.00, 0)],
            '04': [
                (0.01, 872.85, 200.85),
                (872.86, 1309.20, 200.70),
                (1309.21, 1713.60, 200.70),
                (1713.61, 1745.70, 193.80),
                (1745.71, 2193.75, 188.70),
                (2193.76, 2327.55, 174.75),
                (2327.56, 2632.65, 160.35),
                (2632.66, 3071.40, 145.35),
                (3071.41, 3510.15, 125.10),
                (3510.16, 3642.60, 107.40),
                (3642.61, 99999999.00, 0)],
            '02': [
                (0.01, 407.33, 93.73),
                (407.34, 610.96, 93.66),
                (610.97, 799.68, 93.66),
                (799.69, 814.66, 90.44),
                (814.67, 1023.75, 88.06),
                (1023.76, 1086.19, 81.55),
                (1086.20, 1228.57, 74.83),
                (1228.58, 1433.32, 67.83),
                (1433.33, 1638.07, 58.38),
                (1638.08, 1699.88, 50.12),
                (1699.89, 99999999.00, 0)],
            '01': [
                (0.01, 58.19, 13.39),
                (58.20, 87.28, 13.38),
                (87.29, 114.24, 13.38),
                (114.25, 116.38, 12.92),
                (116.39, 146.25, 12.58),
                (146.26, 155.17, 11.65),
                (155.18, 175.51, 10.69),
                (175.52, 204.76, 9.69),
                (204.77, 234.01, 8.34),
                (234.02, 242.84, 7.16),
                (242.85, 99999999.00, 0)],
        }
        table_aux = table.get(contract.l10n_mx_edi_schedule_pay_id.code, [])
        if table_aux:
            for value in table_aux:
                if income_period >= value[0] and value[1] >= income_period:
                    result = value[2]
                    break
        </field>
    </record>

    <record id="hr_salary_rule_other_payment_002_603_ff" model="hr.salary.rule">
        <field name="name">Subsidio para el empleo - efectivamente entregado al trabajador</field>
        <field name="code">OP002</field>
        <field name="l10n_mx_edi_code">002</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_ff" />
        <field name="sequence">72</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_other_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = AUX_OP002
result = result - abs(AUX_ISR) if result &gt; abs(AUX_ISR) else 0
        </field>
    </record>

    <record id="hr_salary_rule_other_payment_999_603_ff" model="hr.salary.rule">
        <field
            name="name"
        >Pagos distintos a los listados y que no deben considerarse como ingreso por sueldos, salarios o ingresos asimilados</field>
        <field name="code">OP999</field>
        <field name="l10n_mx_edi_code">999</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_ff" />
        <field name="sequence">21</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_other_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['op_999'].amount if 'op_999 ' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_other_payment_999_603_ff" model="hr.payslip.input.type">
        <field
            name="name"
        >Pagos distintos a los listados y que no deben considerarse como ingreso por sueldos, salarios o ingresos asimilados</field>
        <field name="code">op_999</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_603_ff')])]" />
    </record>

    <!-- Neto -->
    <record id="hr_rule_net_salary_603_ff" model="hr.salary.rule">
        <field name="name">Salario Neto</field>
        <field name="code">NET</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_ff" />
        <field name="sequence">81</field>
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_netsa_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = categories['PERGRA'] + categories['DED'] + categories['PEREXE'] + categories['OTHER']</field>
    </record>

    <!-- Estructure NF -->
    <!-- Perceptions -->
    <record id="hr_salary_rule_perception_001_g_601_nf" model="hr.salary.rule">
        <field name="name">Sueldos, Salarios Rayas y Jornales</field>
        <field name="code">PG001</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_nf" />
        <field name="sequence" eval="10" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = ((contract.wage * 12) / year_days)
if contract.l10n_mx_edi_schedule_pay_id.code ==  '01':
    result = daily_wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '02':
    result = daily_wage * 7
elif contract.l10n_mx_edi_schedule_pay_id.code == '03':
    result = daily_wage * 14
elif contract.l10n_mx_edi_schedule_pay_id.code == '04':
    result = contract.wage * 0.5
elif contract.l10n_mx_edi_schedule_pay_id.code == '05':
    result = contract.wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '06':
    result = contract.wage * 2
elif contract.l10n_mx_edi_schedule_pay_id.code == '10':
    result = contract.wage * 10
        </field>
    </record>

    <record id="hr_salary_rule_perception_019_601_nf" model="hr.salary.rule">
        <field name="name">Horas extra</field>
        <field name="code">PE019</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_nf" />
        <field name="sequence" eval="11" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = ((contract.wage * 12) / year_days)
hourly_wage = (daily_wage / 8)
result = inputs['pe_019'].amount * hourly_wage if 'pe_019' in inputs else 0
        </field>
    </record>

    <record id="hr_payslip_input_type_perception_019_601_nf" model="hr.payslip.input.type">
        <field name="name">Horas extra</field>
        <field name="code">pe_019</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_601_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_028_g_601_nf" model="hr.salary.rule">
        <field name="name">Comisiones</field>
        <field name="code">PG028</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_nf" />
        <field name="sequence" eval="12" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pg_028'].amount if 'pg_028' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_perception_028_g_601_nf" model="hr.payslip.input.type">
        <field name="name">Comisiones</field>
        <field name="code">pg_028</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_601_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_047_e_601_nf" model="hr.salary.rule">
        <field name="name">Alimentación</field>
        <field name="code">PE047</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_nf" />
        <field name="sequence" eval="13" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = ((contract.l10n_mx_edi_feeding * 12) / year_days)
if contract.l10n_mx_edi_schedule_pay_id.code ==  '01':
    result = daily_wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '02':
    result = daily_wage * 7
elif contract.l10n_mx_edi_schedule_pay_id.code == '03':
    result = daily_wage * 14
elif contract.l10n_mx_edi_schedule_pay_id.code == '04':
    result = daily_wage * 15
elif contract.l10n_mx_edi_schedule_pay_id.code == '05':
    result = contract.l10n_mx_edi_feeding
elif contract.l10n_mx_edi_schedule_pay_id.code == '06':
    result = contract.l10n_mx_edi_feeding * 2
elif contract.l10n_mx_edi_schedule_pay_id.code == '10':
    result = contract.l10n_mx_edi_feeding * 10
        </field>
    </record>

    <record id="hr_salary_rule_perception_033_g_601_nf" model="hr.salary.rule">
        <field name="name">Ayuda para renta</field>
        <field name="code">PG033</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_nf" />
        <field name="sequence" eval="14" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = ((contract.l10n_mx_edi_housing * 12) / year_days)
if contract.l10n_mx_edi_schedule_pay_id.code ==  '01':
    result = daily_wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '02':
    result = daily_wage * 7
elif contract.l10n_mx_edi_schedule_pay_id.code == '03':
    result = daily_wage * 14
elif contract.l10n_mx_edi_schedule_pay_id.code == '04':
    result = daily_wage * 15
elif contract.l10n_mx_edi_schedule_pay_id.code == '05':
    result = contract.l10n_mx_edi_housing
elif contract.l10n_mx_edi_schedule_pay_id.code == '06':
    result = contract.l10n_mx_edi_housing * 2
elif contract.l10n_mx_edi_schedule_pay_id.code == '10':
    result = contract.l10n_mx_edi_housing * 10
        </field>
    </record>

    <record id="hr_salary_rule_perception_050_e_601_nf" model="hr.salary.rule">
        <field name="name">Viáticos</field>
        <field name="code">PE050</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_nf" />
        <field name="sequence" eval="16" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pe_050'].amount if 'pe_050' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_perception_050_e_601_nf" model="hr.payslip.input.type">
        <field name="name">Viáticos</field>
        <field name="code">pe_050</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_601_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_038_e_601_nf" model="hr.salary.rule">
        <field name="name">Otros ingresos por salarios</field>
        <field name="code">PE038</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_nf" />
        <field name="sequence" eval="18" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pe_038'].amount if 'pe_038' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_perception_038_e_601_nf" model="hr.payslip.input.type">
        <field name="name">Otros ingresos por salarios</field>
        <field name="code">pe_038</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_601_nf')])]" />
    </record>

    <!-- Deductions -->
    <record id="hr_salary_rule_deduction_004_loan_company_601_nf" model="hr.salary.rule">
        <field name="name">Pago de préstamo</field>
        <field name="code">PC004</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_nf" />
        <field name="sequence" eval="101" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = inputs['pe_0004'].amount * -1 if 'pe_0004' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_deduction_004_loan_company_601_nf" model="hr.payslip.input.type">
        <field name="name">Pago de prestamo</field>
        <field name="code">pc_004</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_601_nf')])]" />
    </record>

    <record id="hr_salary_rule_deduction_014_601_nf" model="hr.salary.rule">
        <field name="name">Averías, Errores, Pérdidas</field>
        <field name="code">014</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_nf" />
        <field name="sequence" eval="102" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['d_014'].amount * -1 if 'd_014 ' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_deduction_014_601_nf" model="hr.payslip.input.type">
        <field name="name">Averias, Errores, Perdidas</field>
        <field name="code">d_014</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_601_nf')])]" />
    </record>

    <record id="hr_salary_rule_deduction_020_601_nf" model="hr.salary.rule">
        <field name="name">Ausencia - Ausentismo</field>
        <field name="code">020</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_nf" />
        <field name="sequence" eval="103" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
if contract.l10n_mx_edi_schedule_pay_id.code in ['01', '02', '03']:
    year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
    daily_wage = ((contract.wage * 12) / year_days)
    result = inputs['d_020'].amount * daily_wage * -1 if 'd_020 ' in inputs else 0
elif contract.l10n_mx_edi_schedule_pay_id.code in ['04', '05', '06', '10']:
    daily_wage = contract.wage / 30
    result = inputs['d_020'].amount * daily_wage * -1 if 'd_020 ' in inputs else 0
        </field>
    </record>

    <record id="hr_payslip_input_type_deduction_020_601_nf" model="hr.payslip.input.type">
        <field name="name">Ausencia - Ausentismo</field>
        <field name="code">d_020</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_601_nf')])]" />
    </record>

    <!-- Other -->
    <record id="hr_salary_rule_other_payment_999_601_nf" model="hr.salary.rule">
        <field name="name">Préstamo personal</field>
        <field name="code">OP999</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_nf" />
        <field name="sequence" eval="201" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_other_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['op_999'].amount if 'op_999 ' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_other_payment_999_601_nf" model="hr.payslip.input.type">
        <field name="name">Prestamo personal</field>
        <field name="code">op_999</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_601_nf')])]" />
    </record>

    <!-- Neto -->
    <record id="hr_rule_net_salary_601_nf" model="hr.salary.rule">
        <field name="name">Salario Neto</field>
        <field name="code">NET</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_601_nf" />
        <field name="sequence" eval="401" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_netsa_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = categories['PERGRA'] + categories['DED'] + categories['PEREXE'] + categories['OTHER']</field>
    </record>

    <!-- Perceptions -->
    <record id="hr_salary_rule_perception_001_g_602_nf" model="hr.salary.rule">
        <field name="name">Sueldos, Salarios Rayas y Jornales</field>
        <field name="code">PG001</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_nf" />
        <field name="sequence" eval="10" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = ((contract.wage * 12) / year_days)
if contract.l10n_mx_edi_schedule_pay_id.code ==  '01':
    result = daily_wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '02':
    result = daily_wage * 7
elif contract.l10n_mx_edi_schedule_pay_id.code == '03':
    result = daily_wage * 14
elif contract.l10n_mx_edi_schedule_pay_id.code == '04':
    result = contract.wage * 0.5
elif contract.l10n_mx_edi_schedule_pay_id.code == '05':
    result = contract.wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '06':
    result = contract.wage * 2
elif contract.l10n_mx_edi_schedule_pay_id.code == '10':
    result = contract.wage * 10
        </field>
    </record>

    <record id="hr_salary_rule_perception_019_602_nf" model="hr.salary.rule">
        <field name="name">Horas extra</field>
        <field name="code">PE019</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_nf" />
        <field name="sequence" eval="11" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = ((contract.wage * 12) / year_days)
hourly_wage = (daily_wage / 8)
result = inputs['pe_019'].amount * hourly_wage if 'pe_019' in inputs else 0
        </field>
    </record>

    <record id="hr_payslip_input_type_perception_019_602_nf" model="hr.payslip.input.type">
        <field name="name">Horas extra</field>
        <field name="code">pe_019</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_602_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_028_g_602_nf" model="hr.salary.rule">
        <field name="name">Comisiones</field>
        <field name="code">PG028</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_nf" />
        <field name="sequence" eval="12" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pg_028'].amount if 'pg_028' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_perception_028_g_602_nf" model="hr.payslip.input.type">
        <field name="name">Comisiones</field>
        <field name="code">pg_028</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_602_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_047_e_602_nf" model="hr.salary.rule">
        <field name="name">Alimentación</field>
        <field name="code">PE047</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_nf" />
        <field name="sequence" eval="13" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = ((contract.l10n_mx_edi_feeding * 12) / year_days)
if contract.l10n_mx_edi_schedule_pay_id.code ==  '01':
    result = daily_wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '02':
    result = daily_wage * 7
elif contract.l10n_mx_edi_schedule_pay_id.code == '03':
    result = daily_wage * 14
elif contract.l10n_mx_edi_schedule_pay_id.code == '04':
    result = daily_wage * 15
elif contract.l10n_mx_edi_schedule_pay_id.code == '05':
    result = contract.l10n_mx_edi_feeding
elif contract.l10n_mx_edi_schedule_pay_id.code == '06':
    result = contract.l10n_mx_edi_feeding * 2
elif contract.l10n_mx_edi_schedule_pay_id.code == '10':
    result = contract.l10n_mx_edi_feeding * 10
        </field>
    </record>

    <record id="hr_salary_rule_perception_033_g_602_nf" model="hr.salary.rule">
        <field name="name">Ayuda para renta</field>
        <field name="code">PG033</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_nf" />
        <field name="sequence" eval="14" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = ((contract.l10n_mx_edi_housing * 12) / year_days)
if contract.l10n_mx_edi_schedule_pay_id.code ==  '01':
    result = daily_wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '02':
    result = daily_wage * 7
elif contract.l10n_mx_edi_schedule_pay_id.code == '03':
    result = daily_wage * 14
elif contract.l10n_mx_edi_schedule_pay_id.code == '04':
    result = daily_wage * 15
elif contract.l10n_mx_edi_schedule_pay_id.code == '05':
    result = contract.l10n_mx_edi_housing
elif contract.l10n_mx_edi_schedule_pay_id.code == '06':
    result = contract.l10n_mx_edi_housing * 2
elif contract.l10n_mx_edi_schedule_pay_id.code == '10':
    result = contract.l10n_mx_edi_housing * 10
        </field>
    </record>

    <record id="hr_salary_rule_perception_050_e_602_nf" model="hr.salary.rule">
        <field name="name">Viáticos</field>
        <field name="code">PE050</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_nf" />
        <field name="sequence" eval="16" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pe_050'].amount if 'pe_050' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_perception_050_e_602_nf" model="hr.payslip.input.type">
        <field name="name">Viáticos</field>
        <field name="code">pe_050</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_602_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_038_e_602_nf" model="hr.salary.rule">
        <field name="name">Otros ingresos por salarios</field>
        <field name="code">PE038</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_nf" />
        <field name="sequence" eval="18" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pe_038'].amount if 'pe_038' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_perception_038_e_602_nf" model="hr.payslip.input.type">
        <field name="name">Otros ingresos por salarios</field>
        <field name="code">pe_038</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_602_nf')])]" />
    </record>

    <!-- Deductions -->
    <record id="hr_salary_rule_deduction_004_loan_company_602_nf" model="hr.salary.rule">
        <field name="name">Pago de préstamo</field>
        <field name="code">PC004</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_nf" />
        <field name="sequence" eval="101" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = inputs['pe_0004'].amount * -1 if 'pe_0004' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_deduction_004_loan_company_602_nf" model="hr.payslip.input.type">
        <field name="name">Pago de prestamo</field>
        <field name="code">pc_004</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_602_nf')])]" />
    </record>

    <record id="hr_salary_rule_deduction_014_602_nf" model="hr.salary.rule">
        <field name="name">Averías, Errores, Pérdidas</field>
        <field name="code">014</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_nf" />
        <field name="sequence" eval="102" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['d_014'].amount * -1 if 'd_014 ' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_deduction_014_602_nf" model="hr.payslip.input.type">
        <field name="name">Averias, Errores, Perdidas</field>
        <field name="code">d_014</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_602_nf')])]" />
    </record>

    <record id="hr_salary_rule_deduction_020_602_nf" model="hr.salary.rule">
        <field name="name">Ausencia - Ausentismo</field>
        <field name="code">020</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_nf" />
        <field name="sequence" eval="103" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
if contract.l10n_mx_edi_schedule_pay_id.code in ['01', '02', '03']:
    year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
    daily_wage = ((contract.wage * 12) / year_days)
    result = inputs['d_020'].amount * daily_wage * -1 if 'd_020 ' in inputs else 0
elif contract.l10n_mx_edi_schedule_pay_id.code in ['04', '05', '06', '10']:
    daily_wage = contract.wage / 30
    result = inputs['d_020'].amount * daily_wage * -1 if 'd_020 ' in inputs else 0
        </field>
    </record>

    <record id="hr_payslip_input_type_deduction_020_602_nf" model="hr.payslip.input.type">
        <field name="name">Ausencia - Ausentismo</field>
        <field name="code">d_020</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_602_nf')])]" />
    </record>

    <!-- Other -->
    <record id="hr_salary_rule_other_payment_999_602_nf" model="hr.salary.rule">
        <field name="name">Préstamo personal</field>
        <field name="code">OP999</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_nf" />
        <field name="sequence" eval="201" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_other_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['op_999'].amount if 'op_999 ' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_other_payment_999_602_nf" model="hr.payslip.input.type">
        <field name="name">Prestamo personal</field>
        <field name="code">op_999</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_602_nf')])]" />
    </record>

    <!-- Neto -->
    <record id="hr_rule_net_salary_602_nf" model="hr.salary.rule">
        <field name="name">Salario Neto</field>
        <field name="code">NET</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_602_nf" />
        <field name="sequence" eval="401" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_netsa_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = categories['PERGRA'] + categories['DED'] + categories['PEREXE'] + categories['OTHER']</field>
    </record>

    <!-- Perceptions -->
    <record id="hr_salary_rule_perception_001_g_603_nf" model="hr.salary.rule">
        <field name="name">Sueldos, Salarios Rayas y Jornales</field>
        <field name="code">PG001</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_nf" />
        <field name="sequence" eval="10" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = ((contract.wage * 12) / year_days)
if contract.l10n_mx_edi_schedule_pay_id.code ==  '01':
    result = daily_wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '02':
    result = daily_wage * 7
elif contract.l10n_mx_edi_schedule_pay_id.code == '03':
    result = daily_wage * 14
elif contract.l10n_mx_edi_schedule_pay_id.code == '04':
    result = contract.wage * 0.5
elif contract.l10n_mx_edi_schedule_pay_id.code == '05':
    result = contract.wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '06':
    result = contract.wage * 2
elif contract.l10n_mx_edi_schedule_pay_id.code == '10':
    result = contract.wage * 10
        </field>
    </record>

    <record id="hr_salary_rule_perception_019_603_nf" model="hr.salary.rule">
        <field name="name">Horas extra</field>
        <field name="code">PE019</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_nf" />
        <field name="sequence" eval="11" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = ((contract.wage * 12) / year_days)
hourly_wage = (daily_wage / 8)
result = inputs['pe_019'].amount * hourly_wage if 'pe_019' in inputs else 0
        </field>
    </record>

    <record id="hr_payslip_input_type_perception_019_603_nf" model="hr.payslip.input.type">
        <field name="name">Horas extra</field>
        <field name="code">pe_019</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_603_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_028_g_603_nf" model="hr.salary.rule">
        <field name="name">Comisiones</field>
        <field name="code">PG028</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_nf" />
        <field name="sequence" eval="12" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pg_028'].amount if 'pg_028' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_perception_028_g_603_nf" model="hr.payslip.input.type">
        <field name="name">Comisiones</field>
        <field name="code">pg_028</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_603_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_047_e_603_nf" model="hr.salary.rule">
        <field name="name">Alimentación</field>
        <field name="code">PE047</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_nf" />
        <field name="sequence" eval="13" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = ((contract.l10n_mx_edi_feeding * 12) / year_days)
if contract.l10n_mx_edi_schedule_pay_id.code ==  '01':
    result = daily_wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '02':
    result = daily_wage * 7
elif contract.l10n_mx_edi_schedule_pay_id.code == '03':
    result = daily_wage * 14
elif contract.l10n_mx_edi_schedule_pay_id.code == '04':
    result = daily_wage * 15
elif contract.l10n_mx_edi_schedule_pay_id.code == '05':
    result = contract.l10n_mx_edi_feeding
elif contract.l10n_mx_edi_schedule_pay_id.code == '06':
    result = contract.l10n_mx_edi_feeding * 2
elif contract.l10n_mx_edi_schedule_pay_id.code == '10':
    result = contract.l10n_mx_edi_feeding * 10
        </field>
    </record>

    <record id="hr_salary_rule_perception_033_g_603_nf" model="hr.salary.rule">
        <field name="name">Ayuda para renta</field>
        <field name="code">PG033</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_nf" />
        <field name="sequence" eval="14" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = ((contract.l10n_mx_edi_housing * 12) / year_days)
if contract.l10n_mx_edi_schedule_pay_id.code ==  '01':
    result = daily_wage
elif contract.l10n_mx_edi_schedule_pay_id.code == '02':
    result = daily_wage * 7
elif contract.l10n_mx_edi_schedule_pay_id.code == '03':
    result = daily_wage * 14
elif contract.l10n_mx_edi_schedule_pay_id.code == '04':
    result = daily_wage * 15
elif contract.l10n_mx_edi_schedule_pay_id.code == '05':
    result = contract.l10n_mx_edi_housing
elif contract.l10n_mx_edi_schedule_pay_id.code == '06':
    result = contract.l10n_mx_edi_housing * 2
elif contract.l10n_mx_edi_schedule_pay_id.code == '10':
    result = contract.l10n_mx_edi_housing * 10
        </field>
    </record>

    <record id="hr_salary_rule_perception_050_e_603_nf" model="hr.salary.rule">
        <field name="name">Viáticos</field>
        <field name="code">PE050</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_nf" />
        <field name="sequence" eval="16" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pe_050'].amount if 'pe_050' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_perception_050_e_603_nf" model="hr.payslip.input.type">
        <field name="name">Viáticos</field>
        <field name="code">pe_050</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_603_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_038_e_603_nf" model="hr.salary.rule">
        <field name="name">Otros ingresos por salarios</field>
        <field name="code">PE038</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_nf" />
        <field name="sequence" eval="18" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pe_038'].amount if 'pe_038' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_perception_038_e_603_nf" model="hr.payslip.input.type">
        <field name="name">Otros ingresos por salarios</field>
        <field name="code">pe_038</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_603_nf')])]" />
    </record>

    <!-- Deductions -->
    <record id="hr_salary_rule_deduction_004_loan_company_603_nf" model="hr.salary.rule">
        <field name="name">Pago de préstamo</field>
        <field name="code">PC004</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_nf" />
        <field name="sequence" eval="101" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = inputs['pe_0004'].amount * -1 if 'pe_0004' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_deduction_004_loan_company_603_nf" model="hr.payslip.input.type">
        <field name="name">Pago de prestamo</field>
        <field name="code">pc_004</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_603_nf')])]" />
    </record>

    <record id="hr_salary_rule_deduction_014_603_nf" model="hr.salary.rule">
        <field name="name">Averías, Errores, Pérdidas</field>
        <field name="code">014</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_nf" />
        <field name="sequence" eval="102" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['d_014'].amount * -1 if 'd_014 ' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_deduction_014_603_nf" model="hr.payslip.input.type">
        <field name="name">Averias, Errores, Perdidas</field>
        <field name="code">d_014</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_603_nf')])]" />
    </record>

    <record id="hr_salary_rule_deduction_020_603_nf" model="hr.salary.rule">
        <field name="name">Ausencia - Ausentismo</field>
        <field name="code">020</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_nf" />
        <field name="sequence" eval="103" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
if contract.l10n_mx_edi_schedule_pay_id.code in ['01', '02', '03']:
    year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
    daily_wage = ((contract.wage * 12) / year_days)
    result = inputs['d_020'].amount * daily_wage * -1 if 'd_020 ' in inputs else 0
elif contract.l10n_mx_edi_schedule_pay_id.code in ['04', '05', '06', '10']:
    daily_wage = contract.wage / 30
    result = inputs['d_020'].amount * daily_wage * -1 if 'd_020 ' in inputs else 0
        </field>
    </record>

    <record id="hr_payslip_input_type_deduction_020_603_nf" model="hr.payslip.input.type">
        <field name="name">Ausencia - Ausentismo</field>
        <field name="code">d_020</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_603_nf')])]" />
    </record>

    <!-- Other -->
    <record id="hr_salary_rule_other_payment_999_603_nf" model="hr.salary.rule">
        <field name="name">Préstamo personal</field>
        <field name="code">OP999</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_nf" />
        <field name="sequence" eval="201" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_other_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['op_999'].amount if 'op_999 ' in inputs else 0</field>
    </record>

    <record id="hr_payslip_input_type_other_payment_999_603_nf" model="hr.payslip.input.type">
        <field name="name">Prestamo personal</field>
        <field name="code">op_999</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_603_nf')])]" />
    </record>

    <!-- Neto -->
    <record id="hr_rule_net_salary_603_nf" model="hr.salary.rule">
        <field name="name">Salario Neto</field>
        <field name="code">NET</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_603_nf" />
        <field name="sequence" eval="401" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_netsa_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = categories['PERGRA'] + categories['DED'] + categories['PEREXE'] + categories['OTHER']</field>
    </record>
</odoo>
