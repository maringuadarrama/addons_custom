<?xml version="1.0" encoding="UTF-8" ?>
<odoo noupdate="1">
    <!-- Perceptions -->
    <record id="hr_salary_rule_perception_001_g_bf_601_nf" model="hr.salary.rule">
        <field name="name">Sueldos, Salarios Rayas y Jornales (parte proporcional)</field>
        <field name="code">PG001</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_601_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
daily_wage = contract.wage / 30
worked_days = contract.get_seniority(payslip.date_from, payslip.date_to).get('days')
result = daily_wage * worked_days
        </field>
        <field name="sequence" eval="101" />
    </record>

    <record id="hr_salary_rule_perception_019_es_bf_601_nf" model="hr.salary.rule">
        <field name="name">Horas extra</field>
        <field name="code">PE019</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_601_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = contract.wage / 30
hourly_wage = (daily_wage / 8)
result = inputs.pe_019 and inputs.pe_019.amount * hourly_wage
        </field>
        <field name="sequence" eval="102" />
    </record>

    <record id="hr_payslip_input_type_perception_019_es_bf_601_nf" model="hr.payslip.input.type">
        <field name="name">Horas extra</field>
        <field name="code">pe_019</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_601_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_028_g_bf_601_nf" model="hr.salary.rule">
        <field name="name">Comisiones</field>
        <field name="code">PG028</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_601_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pg_028'].amount if 'pg_028' in inputs else 0</field>
        <field name="sequence" eval="103" />
    </record>

    <record id="hr_payslip_input_type_perception_028_g_bf_601_nf" model="hr.payslip.input.type">
        <field name="name">Comisiones</field>
        <field name="code">pg_028</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_601_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_047_e_bf_601_nf" model="hr.salary.rule">
        <field name="name">Alimentación (parte proporcional)</field>
        <field name="code">PE047</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_601_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
daily_wage = contract.l10n_mx_edi_feeding / 30
worked_days = contract.get_seniority(payslip.date_from, payslip.date_to).get('days')
result = daily_wage * worked_days
        </field>
        <field name="sequence" eval="104" />
    </record>

    <record id="hr_salary_rule_perception_033_g_bf_601_nf" model="hr.salary.rule">
        <field name="name">Ayuda para renta (parte proporcional)</field>
        <field name="code">PG033</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_601_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = ((contract.l10n_mx_edi_housing * 12) / year_days)
worked_days = contract.get_seniority(payslip.date_from, payslip.date_to).get('days')
result = daily_wage * worked_days
        </field>
        <field name="sequence" eval="105" />
    </record>

    <record id="hr_salary_rule_perception_050_e_bf_601_nf" model="hr.salary.rule">
        <field name="name">Viáticos</field>
        <field name="code">PE050</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_601_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pe_050'].amount if 'pe_050' in inputs else 0</field>
        <field name="sequence" eval="107" />
    </record>

    <record id="hr_payslip_input_type_perception_050_e_bf_601_nf" model="hr.payslip.input.type">
        <field name="name">Viáticos</field>
        <field name="code">pe_050</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_601_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_038_e_bf_601_nf" model="hr.salary.rule">
        <field name="name">Otros ingresos por salarios</field>
        <field name="code">PE038</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_601_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pe_038'].amount if 'pe_038' in inputs else 0</field>
        <field name="sequence" eval="109" />
    </record>

    <record id="hr_payslip_input_type_perception_038_e_bf_601_nf" model="hr.payslip.input.type">
        <field name="name">Otros ingresos por salarios</field>
        <field name="code">pe_038</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_601_nf')])]" />
    </record>

    <!-- Deductions -->
    <record id="hr_salary_rule_deduction_004_loan_company_bf_601_nf" model="hr.salary.rule">
        <field name="name">Pago de préstamo</field>
        <field name="code">PC004</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_601_nf" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = inputs['pe_0004'].amount * -1 if 'pe_0004' in inputs else 0</field>
        <field name="sequence" eval="201" />
    </record>

    <record id="hr_payslip_input_type_deduction_004_loan_company_bf_601_nf" model="hr.payslip.input.type">
        <field name="name">Pago de prestamo</field>
        <field name="code">pc_004</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_601_nf')])]" />
    </record>

    <record id="hr_salary_rule_deduction_014_bf_601_nf" model="hr.salary.rule">
        <field name="name">Averías, Errores, Pérdidas</field>
        <field name="code">016</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_601_nf" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['d_014'].amount * -1 if 'd_014 ' in inputs else 0</field>
        <field name="sequence" eval="202" />
    </record>

    <record id="hr_payslip_input_type_deduction_014_bf_601_nf" model="hr.payslip.input.type">
        <field name="name">Averias, Errores, Perdidas</field>
        <field name="code">d_014</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_601_nf')])]" />
    </record>

    <record id="hr_salary_rule_deduction_020_bf_601_nf" model="hr.salary.rule">
        <field name="name">Ausencia - Ausentismo</field>
        <field name="code">D020</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_601_nf" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
if contract.l10n_mx_edi_schedule_pay_id.code in ['01', '02', '03']:
    year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
    daily_wage = ((contract.wage * 12) / year_days)
    result = inputs['d_020'].amount * daily_wage * -1 if 'd_020 ' in inputs else 0
elif contract.l10n_mx_edi_schedule_pay_id.code in ['04', '05', '06', '10']:
    daily_wage = contract.wage / 30
    result = inputs['d_020'].amount * daily_wage * -1 if 'd_020 ' in inputs else 0
        </field>
        <field name="sequence" eval="203" />
    </record>

    <record id="hr_payslip_input_type_deduction_020_bf_601_nf" model="hr.payslip.input.type">
        <field name="name">Ausencia - Ausentismo</field>
        <field name="code">d_020</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_601_nf')])]" />
    </record>

    <!-- Finiquito -->
    <record id="hr_salary_rule_perception_022_e_bf_601_nf" model="hr.salary.rule">
        <field name="name">Prima por antigüedad</field>
        <field name="code">PE022</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_601_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
seniority = contract.get_seniority(date_to=payslip.date_to).get('years')
if payslip.struct_id.type_id == payslip.env.ref('l10n_mx_edi_payslip.payroll_structure_type_base_finiquito') and seniority >= 15:
    year = payslip.date_to.year if contract.date_start.replace(year=payslip.date_to.year) &lt; payslip.date_to else payslip.date_to.year -1
    date_start = contract.date_start if contract.date_start.year == payslip.date_to else contract.date_start.replace(year=year)
    seniority += round(1 / 365 * (contract.get_seniority(date_start, date_to=payslip.date_to, method='a')['days'] - 1), 2)
    minimum_wage = employee.l10n_mx_edi_employer_registration_id.minimum_wage or contract.company_id.l10n_mx_edi_minimum_wage
    sbc = contract.l10n_mx_edi_integrated_salary
    # The basis for making the calculation can not be less than a minimum wage or more than two.
    base = minimum_wage if minimum_wage > sbc else (minimum_wage * 2 if sbc > minimum_wage * 2 else sbc)
    days = 12 * seniority
    result = base * days
        </field>
        <field name="sequence" eval="401" />
    </record>

    <record id="hr_salary_rule_perception_001_holidays_not_enjoyed_bf_601_nf" model="hr.salary.rule">
        <field name="name">Vacaciones no disfrutadas</field>
        <field name="code">PGHNOE001</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_601_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
daily_wage = contract.wage/30
result = inputs.pghnoe_001 and inputs.pghnoe_001.amount * daily_wage</field>
        <field name="sequence" eval="402" />
    </record>

    <record id="hr_payslip_input_type_perception_001_holidays_not_enjoyed_bf_601_nf" model="hr.payslip.input.type">
        <field name="code">pghnoe_001</field>
        <field name="name">Vacaciones no disfrutadas (dias)</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_601_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_023_e_2_bf_601_nf" model="hr.salary.rule">
        <field name="name">Prima Vacacional (parte proporcional)</field>
        <field name="code">PE2023</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_601_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = PGHNOE001 * (contract.l10n_mx_edi_vacation_bonus or 25) / 100
        </field>
        <field name="sequence" eval="403" />
    </record>

    <record id="hr_salary_rule_perception_023_e_3_bf_601_nf" model="hr.salary.rule">
        <field name="name">Aguinaldo (parte proporcional)</field>
        <field name="code">PE3023</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_601_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
daily_wage = contract.wage / 30
days = contract.get_seniority(payslip.date_from, payslip.date_to).get("days")
result = (daily_wage * 15) * (days / 365)
        </field>
        <field name="sequence" eval="404" />
    </record>

    <!-- Sueldo Neto -->
    <record id="hr_rule_net_salary_0_bf_601_nf" model="hr.salary.rule">
        <field name="name">Net Salary</field>
        <field name="code">NetSalary</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_601_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_netsa_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = categories.PERGRA - categories.DED + categories.PEREXE + categories.OTHER</field>
        <field name="sequence" eval="601" />
    </record>

    <!-- Perceptions -->
    <record id="hr_salary_rule_perception_001_g_bf_602_nf" model="hr.salary.rule">
        <field name="name">Sueldos, Salarios Rayas y Jornales (parte proporcional)</field>
        <field name="code">PG001</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_602_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
daily_wage = contract.wage / 30
worked_days = contract.get_seniority(payslip.date_from, payslip.date_to).get('days')
result = daily_wage * worked_days
        </field>
        <field name="sequence" eval="101" />
    </record>

    <record id="hr_salary_rule_perception_019_es_bf_602_nf" model="hr.salary.rule">
        <field name="name">Horas extra</field>
        <field name="code">PE019</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_602_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = contract.wage / 30
hourly_wage = (daily_wage / 8)
result = inputs.pe_019 and inputs.pe_019.amount * hourly_wage
        </field>
        <field name="sequence" eval="102" />
    </record>

    <record id="hr_payslip_input_type_perception_019_es_bf_602_nf" model="hr.payslip.input.type">
        <field name="name">Horas extra</field>
        <field name="code">pe_019</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_602_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_028_g_bf_602_nf" model="hr.salary.rule">
        <field name="name">Comisiones</field>
        <field name="code">PG028</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_602_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pg_028'].amount if 'pg_028' in inputs else 0</field>
        <field name="sequence" eval="103" />
    </record>

    <record id="hr_payslip_input_type_perception_028_g_bf_602_nf" model="hr.payslip.input.type">
        <field name="name">Comisiones</field>
        <field name="code">pg_028</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_602_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_047_e_bf_602_nf" model="hr.salary.rule">
        <field name="name">Alimentación (parte proporcional)</field>
        <field name="code">PE047</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_602_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
daily_wage = contract.l10n_mx_edi_feeding / 30
worked_days = contract.get_seniority(payslip.date_from, payslip.date_to).get('days')
result = daily_wage * worked_days
        </field>
        <field name="sequence" eval="104" />
    </record>

    <record id="hr_salary_rule_perception_033_g_bf_602_nf" model="hr.salary.rule">
        <field name="name">Ayuda para renta (parte proporcional)</field>
        <field name="code">PG033</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_602_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = ((contract.l10n_mx_edi_housing * 12) / year_days)
worked_days = contract.get_seniority(payslip.date_from, payslip.date_to).get('days')
result = daily_wage * worked_days
        </field>
        <field name="sequence" eval="105" />
    </record>

    <record id="hr_salary_rule_perception_050_e_bf_602_nf" model="hr.salary.rule">
        <field name="name">Viáticos</field>
        <field name="code">PE050</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_602_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pe_050'].amount if 'pe_050' in inputs else 0</field>
        <field name="sequence" eval="107" />
    </record>

    <record id="hr_payslip_input_type_perception_050_e_bf_602_nf" model="hr.payslip.input.type">
        <field name="name">Viáticos</field>
        <field name="code">pe_050</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_602_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_038_e_bf_602_nf" model="hr.salary.rule">
        <field name="name">Otros ingresos por salarios</field>
        <field name="code">PE038</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_602_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pe_038'].amount if 'pe_038' in inputs else 0</field>
        <field name="sequence" eval="109" />
    </record>

    <record id="hr_payslip_input_type_perception_038_e_bf_602_nf" model="hr.payslip.input.type">
        <field name="name">Otros ingresos por salarios</field>
        <field name="code">pe_038</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_602_nf')])]" />
    </record>

    <!-- Deductions -->
    <record id="hr_salary_rule_deduction_004_loan_company_bf_602_nf" model="hr.salary.rule">
        <field name="name">Pago de préstamo</field>
        <field name="code">PC004</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_602_nf" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = inputs['pe_0004'].amount * -1 if 'pe_0004' in inputs else 0</field>
        <field name="sequence" eval="201" />
    </record>

    <record id="hr_payslip_input_type_deduction_004_loan_company_bf_602_nf" model="hr.payslip.input.type">
        <field name="name">Pago de prestamo</field>
        <field name="code">pc_004</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_602_nf')])]" />
    </record>

    <record id="hr_salary_rule_deduction_014_bf_602_nf" model="hr.salary.rule">
        <field name="name">Averías, Errores, Pérdidas</field>
        <field name="code">016</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_602_nf" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['d_014'].amount * -1 if 'd_014 ' in inputs else 0</field>
        <field name="sequence" eval="202" />
    </record>

    <record id="hr_payslip_input_type_deduction_014_bf_602_nf" model="hr.payslip.input.type">
        <field name="name">Averias, Errores, Perdidas</field>
        <field name="code">d_014</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_602_nf')])]" />
    </record>

    <record id="hr_salary_rule_deduction_020_bf_602_nf" model="hr.salary.rule">
        <field name="name">Ausencia - Ausentismo</field>
        <field name="code">D020</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_602_nf" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
if contract.l10n_mx_edi_schedule_pay_id.code in ['01', '02', '03']:
    year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
    daily_wage = ((contract.wage * 12) / year_days)
    result = inputs['d_020'].amount * daily_wage * -1 if 'd_020 ' in inputs else 0
elif contract.l10n_mx_edi_schedule_pay_id.code in ['04', '05', '06', '10']:
    daily_wage = contract.wage / 30
    result = inputs['d_020'].amount * daily_wage * -1 if 'd_020 ' in inputs else 0
        </field>
        <field name="sequence" eval="203" />
    </record>

    <record id="hr_payslip_input_type_deduction_020_bf_602_nf" model="hr.payslip.input.type">
        <field name="name">Ausencia - Ausentismo</field>
        <field name="code">d_020</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_602_nf')])]" />
    </record>

    <!-- Finiquito -->
    <record id="hr_salary_rule_perception_022_e_bf_602_nf" model="hr.salary.rule">
        <field name="name">Prima por antigüedad</field>
        <field name="code">PE022</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_602_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
seniority = contract.get_seniority(date_to=payslip.date_to).get('years')
if payslip.struct_id.type_id == payslip.env.ref('l10n_mx_edi_payslip.payroll_structure_type_base_finiquito') and seniority >= 15:
    year = payslip.date_to.year if contract.date_start.replace(year=payslip.date_to.year) &lt; payslip.date_to else payslip.date_to.year -1
    date_start = contract.date_start if contract.date_start.year == payslip.date_to else contract.date_start.replace(year=year)
    seniority += round(1 / 365 * (contract.get_seniority(date_start, date_to=payslip.date_to, method='a')['days'] - 1), 2)
    minimum_wage = employee.l10n_mx_edi_employer_registration_id.minimum_wage or contract.company_id.l10n_mx_edi_minimum_wage
    sbc = contract.l10n_mx_edi_integrated_salary
    # The basis for making the calculation can not be less than a minimum wage or more than two.
    base = minimum_wage if minimum_wage > sbc else (minimum_wage * 2 if sbc > minimum_wage * 2 else sbc)
    days = 12 * seniority
    result = base * days
        </field>
        <field name="sequence" eval="401" />
    </record>

    <record id="hr_salary_rule_perception_001_holidays_not_enjoyed_bf_602_nf" model="hr.salary.rule">
        <field name="name">Vacaciones no disfrutadas</field>
        <field name="code">PGHNOE001</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_602_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
daily_wage = contract.wage/30
result = inputs.pghnoe_001 and inputs.pghnoe_001.amount * daily_wage</field>
        <field name="sequence" eval="402" />
    </record>

    <record id="hr_payslip_input_type_perception_001_holidays_not_enjoyed_bf_602_nf" model="hr.payslip.input.type">
        <field name="code">pghnoe_001</field>
        <field name="name">Vacaciones no disfrutadas (dias)</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_602_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_023_e_2_bf_602_nf" model="hr.salary.rule">
        <field name="name">Prima Vacacional (parte proporcional)</field>
        <field name="code">PE2023</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_602_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = PGHNOE001 * (contract.l10n_mx_edi_vacation_bonus or 25) / 100
        </field>
        <field name="sequence" eval="403" />
    </record>

    <record id="hr_salary_rule_perception_023_e_3_bf_602_nf" model="hr.salary.rule">
        <field name="name">Aguinaldo (parte proporcional)</field>
        <field name="code">PE3023</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_602_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
daily_wage = contract.wage / 30
days = contract.get_seniority(payslip.date_from, payslip.date_to).get("days")
result = (daily_wage * 15) * (days / 365)
        </field>
        <field name="sequence" eval="404" />
    </record>

    <!-- Sueldo Neto -->
    <record id="hr_rule_net_salary_0_bf_602_nf" model="hr.salary.rule">
        <field name="name">Net Salary</field>
        <field name="code">NetSalary</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_602_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_netsa_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = categories.PERGRA - categories.DED + categories.PEREXE + categories.OTHER</field>
        <field name="sequence" eval="601" />
    </record>

    <!-- Perceptions -->
    <record id="hr_salary_rule_perception_001_g_bf_603_nf" model="hr.salary.rule">
        <field name="name">Sueldos, Salarios Rayas y Jornales (parte proporcional)</field>
        <field name="code">PG001</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_603_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
daily_wage = contract.wage / 30
worked_days = contract.get_seniority(payslip.date_from, payslip.date_to).get('days')
result = daily_wage * worked_days
        </field>
        <field name="sequence" eval="101" />
    </record>

    <record id="hr_salary_rule_perception_019_es_bf_603_nf" model="hr.salary.rule">
        <field name="name">Horas extra</field>
        <field name="code">PE019</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_603_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = contract.wage / 30
hourly_wage = (daily_wage / 8)
result = inputs.pe_019 and inputs.pe_019.amount * hourly_wage
        </field>
        <field name="sequence" eval="102" />
    </record>

    <record id="hr_payslip_input_type_perception_019_es_bf_603_nf" model="hr.payslip.input.type">
        <field name="name">Horas extra</field>
        <field name="code">pe_019</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_603_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_028_g_bf_603_nf" model="hr.salary.rule">
        <field name="name">Comisiones</field>
        <field name="code">PG028</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_603_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pg_028'].amount if 'pg_028' in inputs else 0</field>
        <field name="sequence" eval="103" />
    </record>

    <record id="hr_payslip_input_type_perception_028_g_bf_603_nf" model="hr.payslip.input.type">
        <field name="name">Comisiones</field>
        <field name="code">pg_028</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_603_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_047_e_bf_603_nf" model="hr.salary.rule">
        <field name="name">Alimentación (parte proporcional)</field>
        <field name="code">PE047</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_603_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
daily_wage = contract.l10n_mx_edi_feeding / 30
worked_days = contract.get_seniority(payslip.date_from, payslip.date_to).get('days')
result = daily_wage * worked_days
        </field>
        <field name="sequence" eval="104" />
    </record>

    <record id="hr_salary_rule_perception_033_g_bf_603_nf" model="hr.salary.rule">
        <field name="name">Ayuda para renta (parte proporcional)</field>
        <field name="code">PG033</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_603_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
daily_wage = ((contract.l10n_mx_edi_housing * 12) / year_days)
worked_days = contract.get_seniority(payslip.date_from, payslip.date_to).get('days')
result = daily_wage * worked_days
        </field>
        <field name="sequence" eval="105" />
    </record>

    <record id="hr_salary_rule_perception_050_e_bf_603_nf" model="hr.salary.rule">
        <field name="name">Viáticos</field>
        <field name="code">PE050</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_603_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pe_050'].amount if 'pe_050' in inputs else 0</field>
        <field name="sequence" eval="107" />
    </record>

    <record id="hr_payslip_input_type_perception_050_e_bf_603_nf" model="hr.payslip.input.type">
        <field name="name">Viáticos</field>
        <field name="code">pe_050</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_603_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_038_e_bf_603_nf" model="hr.salary.rule">
        <field name="name">Otros ingresos por salarios</field>
        <field name="code">PE038</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_603_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['pe_038'].amount if 'pe_038' in inputs else 0</field>
        <field name="sequence" eval="109" />
    </record>

    <record id="hr_payslip_input_type_perception_038_e_bf_603_nf" model="hr.payslip.input.type">
        <field name="name">Otros ingresos por salarios</field>
        <field name="code">pe_038</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_603_nf')])]" />
    </record>

    <!-- Deductions -->
    <record id="hr_salary_rule_deduction_004_loan_company_bf_603_nf" model="hr.salary.rule">
        <field name="name">Pago de préstamo</field>
        <field name="code">PC004</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_603_nf" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = inputs['pe_0004'].amount * -1 if 'pe_0004' in inputs else 0</field>
        <field name="sequence" eval="201" />
    </record>

    <record id="hr_payslip_input_type_deduction_004_loan_company_bf_603_nf" model="hr.payslip.input.type">
        <field name="name">Pago de prestamo</field>
        <field name="code">pc_004</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_603_nf')])]" />
    </record>

    <record id="hr_salary_rule_deduction_014_bf_603_nf" model="hr.salary.rule">
        <field name="name">Averías, Errores, Pérdidas</field>
        <field name="code">016</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_603_nf" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">result = inputs['d_014'].amount * -1 if 'd_014 ' in inputs else 0</field>
        <field name="sequence" eval="202" />
    </record>

    <record id="hr_payslip_input_type_deduction_014_bf_603_nf" model="hr.payslip.input.type">
        <field name="name">Averias, Errores, Perdidas</field>
        <field name="code">d_014</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_603_nf')])]" />
    </record>

    <record id="hr_salary_rule_deduction_020_bf_603_nf" model="hr.salary.rule">
        <field name="name">Ausencia - Ausentismo</field>
        <field name="code">D020</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_603_nf" />
        <field name="category_id" ref="hr_payroll.DED" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
if contract.l10n_mx_edi_schedule_pay_id.code in ['01', '02', '03']:
    year_days = contract._l10n_mx_edi_year_days(payslip.date_to)
    daily_wage = ((contract.wage * 12) / year_days)
    result = inputs['d_020'].amount * daily_wage * -1 if 'd_020 ' in inputs else 0
elif contract.l10n_mx_edi_schedule_pay_id.code in ['04', '05', '06', '10']:
    daily_wage = contract.wage / 30
    result = inputs['d_020'].amount * daily_wage * -1 if 'd_020 ' in inputs else 0
        </field>
        <field name="sequence" eval="203" />
    </record>

    <record id="hr_payslip_input_type_deduction_020_bf_603_nf" model="hr.payslip.input.type">
        <field name="name">Ausencia - Ausentismo</field>
        <field name="code">d_020</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_603_nf')])]" />
    </record>

    <!-- Finiquito -->
    <record id="hr_salary_rule_perception_022_e_bf_603_nf" model="hr.salary.rule">
        <field name="name">Prima por antigüedad</field>
        <field name="code">PE022</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_603_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
seniority = contract.get_seniority(date_to=payslip.date_to).get('years')
if payslip.struct_id.type_id == payslip.env.ref('l10n_mx_edi_payslip.payroll_structure_type_base_finiquito') and seniority >= 15:
    year = payslip.date_to.year if contract.date_start.replace(year=payslip.date_to.year) &lt; payslip.date_to else payslip.date_to.year -1
    date_start = contract.date_start if contract.date_start.year == payslip.date_to else contract.date_start.replace(year=year)
    seniority += round(1 / 365 * (contract.get_seniority(date_start, date_to=payslip.date_to, method='a')['days'] - 1), 2)
    minimum_wage = employee.l10n_mx_edi_employer_registration_id.minimum_wage or contract.company_id.l10n_mx_edi_minimum_wage
    sbc = contract.l10n_mx_edi_integrated_salary
    # The basis for making the calculation can not be less than a minimum wage or more than two.
    base = minimum_wage if minimum_wage > sbc else (minimum_wage * 2 if sbc > minimum_wage * 2 else sbc)
    days = 12 * seniority
    result = base * days
        </field>
        <field name="sequence" eval="401" />
    </record>

    <record id="hr_salary_rule_perception_001_holidays_not_enjoyed_bf_603_nf" model="hr.salary.rule">
        <field name="name">Vacaciones no disfrutadas</field>
        <field name="code">PGHNOE001</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_603_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
daily_wage = contract.wage/30
result = inputs.pghnoe_001 and inputs.pghnoe_001.amount * daily_wage</field>
        <field name="sequence" eval="402" />
    </record>

    <record id="hr_payslip_input_type_perception_001_holidays_not_enjoyed_bf_603_nf" model="hr.payslip.input.type">
        <field name="code">pghnoe_001</field>
        <field name="name">Vacaciones no disfrutadas (dias)</field>
        <field name="struct_ids" eval="[(6, 0, [ref('hr_payroll_structure_nomina_finiquito_603_nf')])]" />
    </record>

    <record id="hr_salary_rule_perception_023_e_2_bf_603_nf" model="hr.salary.rule">
        <field name="name">Prima Vacacional (parte proporcional)</field>
        <field name="code">PE2023</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_603_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = PGHNOE001 * (contract.l10n_mx_edi_vacation_bonus or 25) / 100
        </field>
        <field name="sequence" eval="403" />
    </record>

    <record id="hr_salary_rule_perception_023_e_3_bf_603_nf" model="hr.salary.rule">
        <field name="name">Aguinaldo (parte proporcional)</field>
        <field name="code">PE3023</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_603_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_perception_mx_exempt" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
daily_wage = contract.wage / 30
days = contract.get_seniority(payslip.date_from, payslip.date_to).get("days")
result = (daily_wage * 15) * (days / 365)
        </field>
        <field name="sequence" eval="404" />
    </record>

    <!-- Sueldo Neto -->
    <record id="hr_rule_net_salary_0_bf_603_nf" model="hr.salary.rule">
        <field name="name">Net Salary</field>
        <field name="code">NetSalary</field>
        <field name="struct_id" ref="hr_payroll_structure_nomina_finiquito_603_nf" />
        <field name="category_id" ref="l10n_mx_edi_payslip.hr_salary_rule_category_netsa_mx" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field
            name="amount_python_compute"
        >result = categories.PERGRA - categories.DED + categories.PEREXE + categories.OTHER</field>
        <field name="sequence" eval="601" />
    </record>
</odoo>
